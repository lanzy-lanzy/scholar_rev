{% extends 'base/base.html' %}

{% block title %}Edit Scholarship - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    .form-field {
        transition: all 0.3s ease;
    }
    
    .form-field:focus-within {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(44, 57, 48, 0.1);
    }
    
    .floating-label {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        background: white;
        padding: 0 6px;
        color: var(--accent-warm);
        transition: all 0.3s ease;
        pointer-events: none;
        z-index: 10;
        font-weight: 500;
        font-size: 0.875rem;
    }
    
    .form-input:focus + .floating-label,
    .form-input:not(:placeholder-shown) + .floating-label {
        top: -8px;
        font-size: 0.75rem;
        color: var(--primary-dark);
        font-weight: 600;
    }
    
    .form-input {
        padding: 16px 16px 8px 16px;
        border-color: var(--neutral-light);
        height: 56px;
    }
    
    .form-input:focus {
        border-color: var(--primary-dark);
        box-shadow: 0 0 0 3px rgba(44, 57, 48, 0.1);
    }
    
    /* Special handling for currency input */
    .currency-input {
        padding-left: 40px !important;
    }
    
    .currency-input + .floating-label {
        left: 40px;
    }
    
    .currency-input:focus + .floating-label,
    .currency-input:not(:placeholder-shown) + .floating-label {
        left: 40px;
        top: -8px;
    }
    
    .animate-fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-slide-up {
        animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
        from { transform: translateY(10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .theme-gradient-bg {
        background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-medium) 50%, var(--accent-warm) 100%);
    }
    
    .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid var(--neutral-light);
    }
    
    .currency-input {
        font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        font-weight: 600;
        color: var(--primary-dark);
    }
    
    .error-shake {
        animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    
    .character-counter {
        font-size: 0.75rem;
        color: var(--accent-warm);
        text-align: right;
        margin-top: 4px;
        font-weight: 500;
    }
    
    .character-counter.warning {
        color: #f59e0b;
    }
    
    .character-counter.danger {
        color: #ef4444;
    }
    
    .theme-header-icon {
        background: linear-gradient(135deg, var(--primary-dark), var(--accent-warm));
    }
    
    .breadcrumb-link {
        color: var(--primary-dark);
        transition: color 0.2s ease;
    }
    
    .breadcrumb-link:hover {
        color: var(--accent-warm);
    }
    
    .form-section-title {
        color: var(--primary-dark);
        font-weight: 700;
        border-bottom: 2px solid var(--neutral-light);
        padding-bottom: 0.5rem;
        margin-bottom: 1.5rem;
    }
    
    .checkbox-container {
        background: linear-gradient(135deg, var(--neutral-light) 0%, rgba(220, 215, 201, 0.5) 100%);
        border: 2px solid var(--neutral-light);
    }
    
    .checkbox-container:hover {
        border-color: var(--accent-warm);
    }
    
    .edit-badge {
        background: linear-gradient(135deg, var(--accent-warm), #B8956A);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen theme-gradient-bg py-8">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Breadcrumb -->
        <nav class="flex mb-6 animate-fade-in" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3 glass-effect rounded-lg px-6 py-3 shadow-lg">
                <li class="inline-flex items-center">
                    <a href="{% url 'core:admin_dashboard' %}" class="breadcrumb-link inline-flex items-center text-sm font-medium">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                        </svg>
                        Admin Dashboard
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <a href="{% url 'core:manage_scholarships' %}" class="breadcrumb-link ml-1 text-sm font-medium md:ml-2">Manage Scholarships</a>
                    </div>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">Edit Scholarship</span>
                    </div>
                </li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="glass-effect rounded-xl mb-8 animate-fade-in shadow-xl">
            <div class="px-8 py-10">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-4xl font-bold mb-3" style="color: var(--primary-dark);">Edit Scholarship</h1>
                        <p class="text-lg" style="color: var(--accent-warm);">Update the details for "{{ scholarship.title }}"</p>
                    </div>
                    <div class="flex-shrink-0">
                        <div class="theme-header-icon p-5 rounded-2xl shadow-lg">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form -->
        <div class="glass-effect rounded-xl shadow-2xl animate-fade-in">
            <form method="post" class="p-8" id="scholarshipForm">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="mb-8 rounded-xl bg-red-50 p-6 border-l-4 border-red-400 animate-slide-up">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800">There were errors with your submission:</h3>
                                <div class="mt-2 text-sm text-red-700">
                                    <ul class="list-disc pl-5 space-y-1">
                                        {% for error in form.non_field_errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <!-- Basic Information Section -->
                <div class="mb-10">
                    <h3 class="form-section-title text-xl">Basic Information</h3>
                    
                    <div class="grid grid-cols-1 gap-8 lg:grid-cols-2">
                        <!-- Title -->
                        <div class="lg:col-span-2">
                            <div class="form-field relative">
                                {{ form.title }}
                                <label for="{{ form.title.id_for_label }}" class="floating-label">
                                    Scholarship Title *
                                </label>
                                <div class="absolute right-4 top-1/2 transform -translate-y-1/2">
                                    <svg class="h-5 w-5" style="color: var(--accent-warm);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                    </svg>
                                </div>
                                {% if form.title.errors %}
                                    <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.title.errors.0 }}</p>
                                {% endif %}
                                <div id="title-counter" class="character-counter"></div>
                            </div>
                        </div>
                        
                        <!-- Award Amount -->
                        <div>
                            <div class="form-field relative">
                                {{ form.award_amount }}
                                <label for="{{ form.award_amount.id_for_label }}" class="floating-label">
                                    Award Amount (PHP) *
                                </label>
                                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 font-bold text-lg" style="color: var(--primary-dark);">
                                    â‚±
                                </div>
                                {% if form.award_amount.errors %}
                                    <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.award_amount.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Available Slots -->
                        <div>
                            <div class="form-field relative">
                                {{ form.available_slots }}
                                <label for="{{ form.available_slots.id_for_label }}" class="floating-label">
                                    Available Slots *
                                </label>
                                <div class="absolute right-4 top-1/2 transform -translate-y-1/2">
                                    <svg class="h-5 w-5" style="color: var(--accent-warm);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </div>
                                {% if form.available_slots.errors %}
                                    <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.available_slots.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Application Deadline -->
                        <div class="lg:col-span-2">
                            <div class="form-field relative">
                                {{ form.application_deadline }}
                                <label for="{{ form.application_deadline.id_for_label }}" class="floating-label">
                                    Application Deadline *
                                </label>
                                <div class="absolute right-4 top-1/2 transform -translate-y-1/2">
                                    <svg class="h-5 w-5" style="color: var(--accent-warm);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                {% if form.application_deadline.errors %}
                                    <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.application_deadline.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Detailed Information Section -->
                <div class="mb-10">
                    <h3 class="form-section-title text-xl">Detailed Information</h3>
                    
                    <div class="grid grid-cols-1 gap-8">
                        <!-- Description -->
                        <div>
                            <div class="form-field relative">
                                <label for="{{ form.description.id_for_label }}" class="block text-sm font-bold mb-3" style="color: var(--primary-dark);">
                                    Description *
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.description.errors.0 }}</p>
                                {% endif %}
                                <div id="description-counter" class="character-counter"></div>
                            </div>
                        </div>
                        
                        <!-- Eligibility Criteria -->
                        <div>
                            <div class="form-field relative">
                                <label for="{{ form.eligibility_criteria.id_for_label }}" class="block text-sm font-bold mb-3" style="color: var(--primary-dark);">
                                    Eligibility Criteria *
                                </label>
                                {{ form.eligibility_criteria }}
                                {% if form.eligibility_criteria.errors %}
                                    <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.eligibility_criteria.errors.0 }}</p>
                                {% endif %}
                                <div id="eligibility-counter" class="character-counter"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Document Requirements Section -->
                <div class="mb-10">
                    <h3 class="form-section-title text-xl">Document Requirements</h3>
                    
                    <div class="checkbox-container p-6 rounded-xl">
                        <div class="mb-4">
                            <p class="text-sm font-medium" style="color: var(--primary-dark);">
                                Select which documents students must upload when applying for this scholarship:
                            </p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {% for choice in form.document_requirements %}
                                <div class="flex items-start p-3 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors">
                                    <div class="flex items-center h-5">
                                        {{ choice.tag }}
                                    </div>
                                    <div class="ml-3">
                                        <label for="{{ choice.id_for_label }}" class="text-sm font-medium cursor-pointer" style="color: var(--primary-dark);">
                                            {{ choice.choice_label }}
                                        </label>
                                    </div>
                                </div>
                            {% empty %}
                                <div class="col-span-2 text-center py-8">
                                    <svg class="mx-auto h-12 w-12 mb-4" style="color: var(--accent-warm);" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <p style="color: var(--accent-warm);" class="font-medium">No document requirements available</p>
                                    <p class="text-sm text-gray-500 mt-1">Create document requirements first to assign them to scholarships.</p>
                                </div>
                            {% endfor %}
                        </div>
                        
                        {% if form.document_requirements.errors %}
                            <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.document_requirements.errors.0 }}</p>
                        {% endif %}
                        
                        <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="flex">
                                <svg class="h-5 w-5 text-blue-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="ml-3">
                                    <h4 class="text-sm font-medium text-blue-800">Document Requirements Info</h4>
                                    <p class="text-sm text-blue-700 mt-1">
                                        Students will be required to upload the selected documents when applying for this scholarship. 
                                        You can manage document requirements in the admin panel.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Status Section -->
                <div class="mb-10">
                    <h3 class="form-section-title text-xl">Status Settings</h3>
                    
                    <div class="checkbox-container p-6 rounded-xl">
                        <div class="flex items-start">
                            <div class="flex items-center h-6">
                                {{ form.is_active }}
                            </div>
                            <div class="ml-4">
                                <label for="{{ form.is_active.id_for_label }}" class="text-lg font-bold cursor-pointer" style="color: var(--primary-dark);">
                                    Make Scholarship Active
                                </label>
                                <p class="mt-1" style="color: var(--accent-warm);">When active, this scholarship will be visible to students and they can apply for it.</p>
                            </div>
                        </div>
                        {% if form.is_active.errors %}
                            <p class="mt-2 text-sm text-red-600 animate-slide-up">{{ form.is_active.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mt-12 flex justify-end space-x-4">
                    <a href="{% url 'core:manage_scholarships' %}" class="btn-outline px-8 py-3">
                        Cancel
                    </a>
                    <button type="submit" class="btn-primary px-10 py-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        Update Scholarship
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('scholarshipForm');
        const inputs = form.querySelectorAll('input, textarea, select');
        
        // Add CSS classes to form elements
        inputs.forEach(input => {
            if (input.type !== 'checkbox') {
                input.classList.add('form-input', 'w-full', 'border', 'rounded-lg', 'transition-all', 'duration-200');
                input.setAttribute('placeholder', ' ');
            }
            
            if (input.id === 'id_award_amount') {
                input.classList.add('currency-input');
            }
            
            // Style textareas
            if (input.tagName === 'TEXTAREA') {
                input.classList.add('min-h-32', 'resize-y');
                input.style.fontFamily = 'inherit';
                input.style.padding = '16px';
                input.style.height = 'auto';
                input.style.minHeight = '120px';
            }
        });
        
        // Character counters
        function setupCharacterCounter(fieldId, maxLength) {
            const field = document.getElementById(fieldId);
            const counter = document.getElementById(fieldId.replace('id_', '') + '-counter');
            
            if (field && counter) {
                function updateCounter() {
                    const length = field.value.length;
                    counter.textContent = `${length}/${maxLength} characters`;
                    
                    if (length > maxLength * 0.9) {
                        counter.classList.add('danger');
                        counter.classList.remove('warning');
                    } else if (length > maxLength * 0.7) {
                        counter.classList.add('warning');
                        counter.classList.remove('danger');
                    } else {
                        counter.classList.remove('warning', 'danger');
                    }
                }
                
                field.addEventListener('input', updateCounter);
                updateCounter();
            }
        }
        
        setupCharacterCounter('id_title', 200);
        setupCharacterCounter('id_description', 1000);
        setupCharacterCounter('id_eligibility_criteria', 1000);
        
        // Currency formatting
        const awardAmountInput = document.getElementById('id_award_amount');
        if (awardAmountInput) {
            awardAmountInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d.]/g, '');
                if (value) {
                    const parts = value.split('.');
                    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    if (parts[1]) {
                        parts[1] = parts[1].substring(0, 2);
                    }
                    e.target.value = parts.join('.');
                }
            });
        }
        
        // Add smooth focus transitions
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.style.transform = 'translateY(-2px)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.style.transform = 'translateY(0)';
            });
        });
    });
</script>
{% endblock %}