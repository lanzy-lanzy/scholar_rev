# Fix: Document Upload Fields Not Showing in Scholarship Application

## Problem
Students were unable to upload required documents when applying for scholarships. The form was showing errors like:
- "Document_1: This field is required"
- "Document_1: Certificate of Enrollment is required"
- "Document_2: This field is required"
- "Document_2: Certificate of Grades is required"

But there were no upload fields visible in the form for these documents.

## Root Cause
The scholarship application template (`templates/students/apply_scholarship.html`) had a **hardcoded single file upload field** instead of dynamically rendering the document requirement fields that were being generated by the `DynamicApplicationForm`.

### What Was Wrong:
1. **Template had hardcoded upload**: Only one generic "supporting_documents" field
2. **Form generates dynamic fields**: The `DynamicApplicationForm` creates fields like `document_1`, `document_2`, etc. for each scholarship requirement
3. **Mismatch**: Template wasn't rendering these dynamic fields, so they were invisible but still required

## Solution

### Updated the Template
**File**: `templates/students/apply_scholarship.html`

Replaced the hardcoded single file upload with a loop that renders all dynamic document fields:

```django
<!-- OLD: Single hardcoded field -->
<input id="supporting_documents" name="supporting_documents" type="file" required>

<!-- NEW: Dynamic fields for each requirement -->
{% for field in form %}
    {% if 'document_' in field.name %}
        <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
            <label for="{{ field.id_for_label }}">
                {{ field.label }}
                {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
            </label>
            
            {% if field.help_text %}
                <p class="text-xs text-gray-500">{{ field.help_text }}</p>
            {% endif %}
            
            {{ field }}
            
            {% if field.errors %}
                <div class="text-sm text-red-600">
                    {% for error in field.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    {% endif %}
{% endfor %}
```

### Added Custom Styling
Added CSS to make the file input fields look professional:

```css
input[type="file"] {
    padding: 0.75rem;
    border: 2px dashed #d1d5db;
    border-radius: 0.75rem;
    background-color: #f9fafb;
    cursor: pointer;
}

input[type="file"]:hover {
    border-color: #06b6d4;
    background-color: #ecfeff;
}

input[type="file"]::file-selector-button {
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 600;
}
```

## How It Works Now

### Backend (Already Working)
1. **DynamicApplicationForm** (`core/forms.py`):
   - Reads scholarship's document requirements
   - Creates a file field for each requirement: `document_1`, `document_2`, etc.
   - Sets required/optional based on requirement settings
   - Adds validation for file size and format

2. **apply_scholarship view** (`core/views.py`):
   - Creates form with scholarship context
   - Processes uploaded files
   - Creates `ApplicationDocument` objects for each uploaded file
   - Links documents to their requirements

### Frontend (Now Fixed)
1. **Template** (`templates/students/apply_scholarship.html`):
   - Loops through all form fields
   - Finds fields starting with `document_`
   - Renders each as a separate upload field
   - Shows label, help text, and error messages
   - Displays required indicator (*)

## Example: How It Appears to Students

If a scholarship has these requirements:
- Certificate of Enrollment (Required)
- Certificate of Grades (Required)
- Birth Certificate (Optional)

The form will now show:

```
Step 3: Required Documents

┌─────────────────────────────────────────────┐
│ Certificate of Enrollment *                 │
│ Max size: 5MB, Formats: PDF, DOC, DOCX     │
│ [Choose File] No file chosen                │
│ ℹ️ Accepted formats: PDF, DOC, DOCX, JPG, PNG│
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ Certificate of Grades *                     │
│ Max size: 5MB, Formats: PDF, DOC, DOCX     │
│ [Choose File] No file chosen                │
│ ℹ️ Accepted formats: PDF, DOC, DOCX, JPG, PNG│
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ Birth Certificate                           │
│ Max size: 5MB, Formats: PDF, JPG, PNG      │
│ [Choose File] No file chosen                │
│ ℹ️ Accepted formats: PDF, DOC, DOCX, JPG, PNG│
└─────────────────────────────────────────────┘
```

## Testing

### Test Case 1: Scholarship with Multiple Requirements
1. **Admin creates scholarship** with 3 document requirements:
   - Certificate of Enrollment (Required)
   - Certificate of Grades (Required)
   - Recommendation Letter (Optional)

2. **Student applies**:
   - Goes to scholarship detail page
   - Clicks "Apply Now"
   - Fills Step 1 (Personal Statement)
   - Fills Step 2 (Academic Info)
   - Goes to Step 3 (Documents)
   - **Should see**: 3 separate upload fields
   - **Should see**: Required indicators on first two
   - **Should see**: Help text for each field

3. **Student uploads**:
   - Uploads Certificate of Enrollment
   - Uploads Certificate of Grades
   - Skips Recommendation Letter (optional)
   - Clicks "Submit Application"
   - **Should succeed**: Application submitted

4. **Verify in database**:
   - Application created
   - 2 ApplicationDocument objects created
   - Each linked to correct requirement

### Test Case 2: Missing Required Document
1. **Student applies** but only uploads 1 of 2 required documents
2. **Should see error**: "Certificate of Grades: This field is required"
3. **Error appears**: Next to the specific upload field
4. **Student uploads**: Missing document
5. **Should succeed**: Application submitted

### Test Case 3: No Document Requirements
1. **Admin creates scholarship** with NO document requirements
2. **Student applies**:
   - Goes to Step 3
   - **Should see**: Info message "No documents required"
   - OR Step 3 is skipped entirely
   - Can submit without uploading anything

## Database Schema

The system uses these models:

```
DocumentRequirement
├── name (e.g., "certificate_enrollment")
├── custom_name (e.g., "Certificate of Enrollment")
├── is_required (True/False)
├── file_format_requirements (e.g., "PDF, DOC, DOCX")
└── max_file_size_mb (e.g., 5)

Scholarship
└── document_requirements (ManyToMany → DocumentRequirement)

Application
├── student
├── scholarship
└── documents (Reverse FK → ApplicationDocument)

ApplicationDocument
├── application (FK → Application)
├── document_requirement (FK → DocumentRequirement)
├── name (e.g., "Certificate of Enrollment - mycert.pdf")
├── file (FileField)
├── file_size (bytes)
└── content_type (MIME type)
```

## Admin Workflow

### Adding Document Requirements to Scholarship

1. **Go to Django Admin** (`/admin/`)
2. **Navigate to**: Scholarships
3. **Edit scholarship**
4. **Scroll to**: "Document requirements" section
5. **Select requirements**: Check boxes for required documents
6. **Save**

OR use the management command:
```bash
python manage.py shell
from core.models import Scholarship, DocumentRequirement
scholarship = Scholarship.objects.get(id=1)
cert_enrollment = DocumentRequirement.objects.get(name='certificate_enrollment')
cert_grades = DocumentRequirement.objects.get(name='certificate_grades')
scholarship.document_requirements.add(cert_enrollment, cert_grades)
```

## Files Modified

1. **templates/students/apply_scholarship.html**
   - Replaced hardcoded file upload with dynamic field rendering
   - Added custom CSS for file inputs
   - Added help text and error display

## Benefits

✅ **Dynamic**: Automatically adapts to scholarship requirements
✅ **Clear**: Each document has its own labeled field
✅ **Validated**: Shows specific errors for each document
✅ **Flexible**: Admins can add/remove requirements anytime
✅ **User-Friendly**: Students see exactly what's needed
✅ **Professional**: Styled file inputs look modern

## Future Enhancements

1. **Drag & Drop**: Add drag-and-drop file upload
2. **Preview**: Show thumbnail preview of uploaded files
3. **Progress**: Show upload progress bar
4. **Multiple Files**: Allow multiple files per requirement
5. **File Manager**: Let students manage uploaded documents
6. **Templates**: Provide downloadable document templates

---

**Status**: ✅ FIXED
**Date**: [Current Date]
**Fixed By**: Kiro AI Assistant
